<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador de Pedidos Herbalife</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Roboto', sans-serif;
    }

    body {
      background-color: #ffffff;
      color: #333;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
      color: #003087;
      font-size: 2em;
      font-weight: 700;
    }

    .pv-total {
      text-align: center;
      padding: 10px;
      background-color: #e9ecef;
      border-radius: 8px;
      margin-bottom: 20px;
      color: #003087;
      font-weight: 500;
    }

    .search-bar {
      width: 100%;
      padding: 10px;
      margin-bottom: 20px;
      border: 2px solid #003087;
      border-radius: 8px;
      background-color: #ffffff;
      color: #333;
    }

    .categories {
      margin-bottom: 20px;
    }

    .category-select {
      width: 100%;
      padding: 12px;
      background-color: #e9ecef;
      border: 2px solid #003087;
      border-radius: 8px;
      color: #003087;
      font-weight: 500;
      cursor: pointer;
    }

    .category-select option {
      background-color: #ffffff;
      color: #333;
    }

    .products {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
      overflow-y: auto;
    }

    .products.active {
      display: grid;
    }

    .product {
      background-color: #e9ecef;
      padding: 15px;
      border-radius: 8px;
      border: 1px solid #003087;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .product h3 {
      font-size: 1.1em;
      margin-bottom: 10px;
      color: #003087;
      font-weight: 500;
    }

    .product p {
      margin-bottom: 5px;
      font-size: 0.9em;
      color: #555;
    }

    .product input {
      width: 70px;
      padding: 8px;
      margin-top: 10px;
      background-color: #ffffff;
      color: #333;
      border: 1px solid #003087;
      border-radius: 5px;
      transition: border-color 0.3s;
    }

    .product input:focus {
      border-color: #d4a017;
      outline: none;
    }

    .summary {
      background-color: #e9ecef;
      padding: 20px;
      border-radius: 8px;
      border: 1px solid #003087;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .summary h2 {
      margin-bottom: 15px;
      color: #003087;
      font-weight: 500;
    }

    .summary p {
      margin-bottom: 8px;
      font-size: 1em;
      color: #555;
    }

    @media (max-width: 768px) {
      .products {
        grid-template-columns: 1fr;
        max-height: none;
        overflow-y: visible;
      }

      h1 {
        font-size: 1.5em;
      }
    }
  </style>
</head>
<body>
  <div id="app" class="container">
    <h1>Simulador de Pedidos Herbalife</h1>
    <div class="pv-total">Total P.V.: {{ totalPV.toFixed(2) }} P.V.</div>

    <input v-model="searchQuery" type="text" class="search-bar" placeholder="Buscar por nombre de producto..." @keyup.enter="searchAndClear">
    <div class="categories">
      <select v-model="selectedCategory" class="category-select" @change="toggleProducts">
        <option v-for="category in categories" :key="category" :value="category">{{ category }}</option>
      </select>
    </div>
    <div class="products" :class="{ active: productsVisible }">
      <div v-for="product in filteredAndSearchedProducts" :key="product.SKU" class="product">
        <h3>{{ product.NOMBRE_DEL_PRODUCTO }} {{ product.SABOR ? `- ${product.SABOR}` : '' }}</h3>
        <p><strong>SKU:</strong> {{ product.SKU }}</p>
        <p><strong>P.V.:</strong> {{ product.PV.toFixed(2) }}</p>
        <p><strong>Base de Ganancia:</strong> ${{ product.BASE_DE_GANANCIA.toFixed(2) }}</p>
        <p><strong>Precio Sugerido:</strong> ${{ product.PRECIO_DE_VENTA_SUGERIDO.toFixed(2) }}</p>
        <p><strong>25%:</strong> ${{ product['0.25'].toFixed(2) }}</p>
        <p><strong>35%:</strong> ${{ product['0.35'].toFixed(2) }}</p>
        <p><strong>42%:</strong> ${{ product['0.42'].toFixed(2) }}</p>
        <p><strong>50%:</strong> ${{ product['0.50'].toFixed(2) }}</p>
        <p><strong>Categoría:</strong> {{ product.CATEGORIA }}</p>
        <input type="number" v-model.number="product.quantity" min="0" @input="updateSummary" placeholder="Cantidad">
      </div>
    </div>

    <div class="summary">
      <h2>Resumen del Pedido</h2>
      <div v-for="item in selectedItems" :key="item.SKU">
        <p>{{ item.NOMBRE_DEL_PRODUCTO }} ({{ item.SABOR ? item.SABOR : 'Sin sabor' }}) - Cantidad: {{ item.quantity }}</p>
        <p>P.V. Total: {{ (item.quantity * item.PV).toFixed(2) }}</p>
      </div>
      <h3>Totales:</h3>
      <p><strong>Puntos de Volumen Total:</strong> {{ totalPV.toFixed(2) }} P.V.</p>
      <p><strong>Total Base de Ganancia:</strong> ${{ totalBase.toFixed(2) }}</p>
      <p><strong>Total Precio Sugerido:</strong> ${{ totalSuggested.toFixed(2) }}</p>
      <p><strong>Total 25%:</strong> ${{ total025.toFixed(2) }}</p>
      <p><strong>Total 35%:</strong> ${{ total035.toFixed(2) }}</p>
      <p><strong>Total 42%:</strong> ${{ total042.toFixed(2) }}</p>
      <p><strong>Total 50%:</strong> ${{ total050.toFixed(2) }}</p>
    </div>
  </div>

  <script>
    const { createApp, reactive } = Vue;

    createApp({
      data() {
        return {
          selectedCategory: 'BATIDOS',
          searchQuery: '',
          productsVisible: true,
          products: [] // Inicializamos como array vacío
        };
      },
      computed: {
        categories() {
          return [...new Set(this.products.map(product => product.CATEGORIA))];
        },
        filteredAndSearchedProducts() {
          let filteredProducts = this.products;

          if (this.searchQuery) {
            const searchTerm = this.removeAccents(this.searchQuery.toLowerCase().trim());
            filteredProducts = this.products.filter(product => {
              const fullName = `${product.NOMBRE_DEL_PRODUCTO} ${product.SABOR || ''}`;
              const normalizedFullName = this.removeAccents(fullName.toLowerCase());
              return normalizedFullName.includes(searchTerm);
            });
          } else {
            filteredProducts = this.products.filter(product =>
              product.CATEGORIA === this.selectedCategory
            );
          }

          return filteredProducts;
        },
        selectedItems() {
          return this.products.filter(product => product.quantity > 0);
        },
        totalPV() {
          return this.selectedItems.reduce((sum, item) => sum + (item.quantity * item.PV), 0);
        },
        totalBase() {
          return this.selectedItems.reduce((sum, item) => sum + (item.quantity * item.BASE_DE_GANANCIA), 0);
        },
        totalSuggested() {
          return this.selectedItems.reduce((sum, item) => sum + (item.quantity * item.PRECIO_DE_VENTA_SUGERIDO), 0);
        },
        total025() {
          return this.selectedItems.reduce((sum, item) => sum + (item.quantity * item['0.25']), 0);
        },
        total035() {
          return this.selectedItems.reduce((sum, item) => sum + (item.quantity * item['0.35']), 0);
        },
        total042() {
          return this.selectedItems.reduce((sum, item) => sum + (item.quantity * item['0.42']), 0);
        },
        total050() {
          return this.selectedItems.reduce((sum, item) => sum + (item.quantity * item['0.50']), 0);
        }
      },
      methods: {
        // Método para eliminar acentos de una cadena
        removeAccents(str) {
          return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
        },
        toggleProducts() {
          this.productsVisible = true;
        },
        searchAndClear() {
          this.searchQuery = '';
        },
        updateSummary() {
          // Forzamos una actualización reactiva si es necesario
          this.products = [...this.products];
        },
        async loadProductsFromJSON() {
          try {
            const response = await fetch('products.json');
            if (!response.ok) {
              throw new Error(`Error al cargar products.json: ${response.status} ${response.statusText}`);
            }
            const data = await response.json();
            // Aseguramos reactividad usando reactive
            this.products = reactive(data.map(product => ({
              SKU: product.SKU || '',
              NOMBRE_DEL_PRODUCTO: product.NOMBRE_DEL_PRODUCTO || '',
              SABOR: product.SABOR || '',
              PV: parseFloat(product.PV) || 0,
              BASE_DE_GANANCIA: parseFloat(product.BASE_DE_GANANCIA) || 0,
              PRECIO_DE_VENTA_SUGERIDO: parseFloat(product.PRECIO_DE_VENTA_SUGERIDO) || 0,
              '0.25': parseFloat(product['0.25']) || 0,
              '0.35': parseFloat(product['0.35']) || 0,
              '0.42': parseFloat(product['0.42']) || 0,
              '0.50': parseFloat(product['0.50']) || 0,
              CATEGORIA: product.CATEGORIA || 'BATIDOS',
              quantity: parseInt(product.quantity, 10) || 0
            })));
            console.log('Productos cargados:', this.products);
          } catch (error) {
            console.error("Error al cargar products.json:", error);
          }
        }
      },
      mounted() {
        this.loadProductsFromJSON();
        this.toggleProducts();
      }
    }).mount('#app');
  </script>
</body>
</html>
